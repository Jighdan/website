---
import Layout from "~/layouts/Default.astro";
import { CONTENT_SERVICE, type NowEntry } from "~/services/content";
import { formatDate } from "~/utilities/date";

export const prerender = true;

export async function getStaticPaths() {
  const entries = await CONTENT_SERVICE.modules("now").getAllExcludingLatest();

  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: entry,
  }));
}

type Props = NowEntry;

const entry = Astro.props;
const date = entry?.date ? formatDate(entry.date) : undefined;
const title = `Now | ${date}`;
const description = `What happened at ${date} in ${entry?.location}.`;
---

<Layout title={title} description={description}>
  <div class="flex flex-col gap-4">
    <div class="flex flex-row gap-2 flex-wrap justify-between items-center">
      <span class="text-sm italic">{entry?.location}</span>

      <p class="text-sm">
        <span>written: </span>

        <time datetime={date} class="lowercase">
          {date}
        </time>
      </p>
    </div>

    <article class="flex flex-col gap-6">
      <div class="flex flex-col gap-4">
        <h2 class="font-semibold">On {date} in {entry.location}</h2>
        <p>
          This is a previous "<i>now</i>" letter. For a more recent update read
          the latest letter, or navigate to the <a href="/now/archive"
            >archive</a
          > where you'd find previous letters like this one.
        </p>
      </div>

      <div set:html={entry?.content} />
    </article>
  </div>
</Layout>
